# ğŸ› ï¸ env-guard CLI Reference

Complete command-line interface documentation for env-guard.

## Table of Contents

- [Installation](#installation)
- [Global Options](#global-options)
- [Commands](#commands)
- [Examples](#examples)
- [Exit Codes](#exit-codes)
- [Configuration](#configuration)
- [Troubleshooting](#troubleshooting)

## Installation

### Global Installation

```bash
npm install -g @miit-daga/env-guard
```

### Local Installation

```bash
npm install @miit-daga/env-guard
```

### Usage

After installation, use the `env-guard` command:

```bash
env-guard <command> [options]
```

## Global Options

### `--help, -h`
Show help information.

```bash
env-guard --help          # Show global help
env-guard <command> --help  # Show command-specific help
```

### `--version, -v`
Show version information.

```bash
env-guard --version
```

### `--verbose, -V`
Enable verbose output for debugging.

```bash
env-guard validate --schema schema.js --verbose
```

## Commands

### `validate`

Validates environment variables against a schema.

#### Synopsis

```bash
env-guard validate [options]
```

#### Options

| Option | Description |
|--------|-------------|
| `--schema <file>` | **Required.** Path to schema file |
| `--env-file <file>` | Path to .env file (default: process.env) |
| `--environment <env>` | Environment name (development, production, etc.) |
| `--format <format>` | Output format: `json` or `table` (default: `table`) |
| `--output <file>` | Write results to file |
| `--exit-on-error` | Exit with code 1 if validation fails |
| `--detailed` | Show detailed error information |

#### Examples

**Basic validation:**
```bash
env-guard validate --schema schema.js
```

**With specific .env file:**
```bash
env-guard validate --schema schema.js --env-file .env.local
```

**Production environment validation:**
```bash
env-guard validate --schema schema.js --environment production
```

**JSON output for scripting:**
```bash
env-guard validate --schema schema.js --format json
```

**Exit on validation failure:**
```bash
env-guard validate --schema schema.js --exit-on-error
```

**Detailed error output:**
```bash
env-guard validate --schema schema.js --detailed
```

#### Output

**Table Format (default):**
```
âœ… Validation successful!

Environment Variables:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Variable        â”‚ Type         â”‚ Value   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PORT            â”‚ port         â”‚ 3000    â”‚
â”‚ DATABASE_URL    â”‚ url          â”‚ âœ…      â”‚
â”‚ DEBUG           â”‚ boolean      â”‚ false   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**JSON Format:**
```json
{
  "success": true,
  "timestamp": "2023-11-11T06:40:20.247Z",
  "environment": "development",
  "variables": {
    "PORT": {
      "type": "port",
      "value": 3000,
      "valid": true
    },
    "DATABASE_URL": {
      "type": "url",
      "value": "postgresql://...",
      "valid": true
    }
  },
  "summary": {
    "total": 3,
    "valid": 3,
    "invalid": 0,
    "missing": 0
  }
}
```

**Error Output:**
```
âŒ Validation failed!

Errors:
1. PORT: Port must be an integer between 1 and 65535
   Expected: valid port number
   Received: 99999
   
2. DATABASE_URL: Required environment variable is missing
   Environment Variable: DATABASE_URL

Summary: 2 errors found
```

---

### `generate`

Generates a .env.example file from a schema.

#### Synopsis

```bash
env-guard generate [options]
```

#### Options

| Option | Description |
|--------|-------------|
| `--schema <file>` | **Required.** Path to schema file |
| `--output <file>` | Output file path (default: `.env.example`) |
| `--include-comments` | Include field descriptions as comments |
| `--overwrite` | Overwrite existing file without asking |
| `--format <format>` | Output format: `env` or `json` (default: `env`) |
| `--environment <env>` | Generate for specific environment |

#### Examples

**Generate basic .env.example:**
```bash
env-guard generate --schema schema.js
```

**With descriptions:**
```bash
env-guard generate --schema schema.js --include-comments
```

**Custom output file:**
```bash
env-guard generate --schema schema.js --output .env.production
```

**JSON format:**
```bash
env-guard generate --schema schema.js --format json
```

**Production environment:**
```bash
env-guard generate --schema schema.js --environment production
```

#### Generated Output

**Basic .env.example:**
```bash
# Generated by env-guard
PORT=3000
NODE_ENV=development
DATABASE_URL=postgresql://localhost:5432/mydb
API_KEY=your-api-key-here
```

**With comments:**
```bash
# Generated by env-guard
# Server port number
PORT=3000
# Environment (development, production, test)
NODE_ENV=development
# Database connection string
DATABASE_URL=postgresql://localhost:5432/mydb
# API authentication key
API_KEY=your-api-key-here
```

---

### `check`

Validates schema definition and shows information.

#### Synopsis

```bash
env-guard check [options]
```

#### Options

| Option | Description |
|--------|-------------|
| `--schema <file>` | **Required.** Path to schema file |
| `--detailed` | Show detailed schema information |
| `--validate` | Validate schema definition |
| `--output <file>` | Write results to file |
| `--format <format>` | Output format: `json` or `table` (default: `table`) |

#### Examples

**Basic schema check:**
```bash
env-guard check --schema schema.js
```

**Detailed schema information:**
```bash
env-guard check --schema schema.js --detailed
```

**Validate schema definition:**
```bash
env-guard check --schema schema.js --validate
```

**JSON output:**
```bash
env-guard check --schema schema.js --format json
```

#### Output

**Basic Check:**
```
âœ… Schema is valid

Schema Information:
- Fields: 5
- Required: 3
- Optional: 2
- Environment overrides: 2
```

**Detailed Information:**
```
âœ… Schema is valid

Schema Information:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Field           â”‚ Type       â”‚ Required â”‚ Default    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PORT            â”‚ port       â”‚ âœ…       â”‚ 3000       â”‚
â”‚ DATABASE_URL    â”‚ url        â”‚ âœ…       â”‚ -          â”‚
â”‚ NODE_ENV        â”‚ string     â”‚ âŒ       â”‚ develop... â”‚
â”‚ DEBUG           â”‚ boolean    â”‚ âŒ       â”‚ false      â”‚
â”‚ API_KEY         â”‚ string     â”‚ âœ…       â”‚ -          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Environment Overrides:
- production: 2 fields
- staging: 1 field

Built-in Validators:
- url: 1 field
- port: 1 field
- string: 2 fields
- boolean: 1 field
```

---

### `help`

Shows help information for commands.

#### Synopsis

```bash
env-guard help [command]
```

#### Examples

```bash
env-guard help           # Global help
env-guard help validate  # Validate command help
env-guard help generate  # Generate command help
env-guard help check     # Check command help
```

## Examples

### Complete Workflow

1. **Create schema file (schema.js):**
```javascript
module.exports = {
  PORT: {
    type: 'port',
    required: true,
    default: 3000,
    description: 'Server port number'
  },
  DATABASE_URL: {
    type: 'url',
    required: true,
    description: 'Database connection string'
  },
  NODE_ENV: {
    type: 'string',
    enum: ['development', 'production', 'test'],
    default: 'development'
  }
};
```

2. **Generate .env.example:**
```bash
env-guard generate --schema schema.js --include-comments
```

3. **Validate current environment:**
```bash
env-guard validate --schema schema.js
```

4. **Check schema definition:**
```bash
env-guard check --schema schema.js --detailed
```

### CI/CD Integration

**GitHub Actions:**
```yaml
- name: Validate Environment
  run: |
    env-guard validate --schema schema.js --exit-on-error
```

**GitLab CI:**
```yaml
validate-env:
  script:
    - env-guard validate --schema schema.js --format json
  artifacts:
    reports:
      env-guard: validation-results.json
```

**Docker:**
```dockerfile
# Validate environment before starting
RUN env-guard validate --schema schema.js --exit-on-error
```

### Programmatic Usage

**Node.js script:**
```javascript
const { spawn } = require('child_process');

// Run env-guard validation
const validation = spawn('env-guard', ['validate', '--schema', 'schema.js']);

validation.stdout.on('data', (data) => {
  console.log(`Validation: ${data}`);
});

validation.stderr.on('data', (data) => {
  console.error(`Error: ${data}`);
});

validation.on('close', (code) => {
  if (code === 0) {
    console.log('âœ… Validation successful');
  } else {
    console.log('âŒ Validation failed');
    process.exit(code);
  }
});
```

## Exit Codes

The CLI uses standard exit codes:

| Code | Meaning |
|------|---------|
| `0` | Success |
| `1` | Validation failed or general error |
| `2` | Command-line argument error |
| `3` | Schema file not found or invalid |
| `4` | Environment file not found |

## Configuration

### Environment Variables

You can set default options using environment variables:

```bash
export ENV_GUARD_DEFAULT_SCHEMA=./schema.js
export ENV_GUARD_DEFAULT_FORMAT=json
export ENV_GUARD_VERBOSE=true
```

### Configuration File

Create a `.env-guard.json` file in your project:

```json
{
  "defaultSchema": "./schema.js",
  "defaultFormat": "table",
  "verbose": false,
  "environments": {
    "development": {
      "strict": false
    },
    "production": {
      "strict": true,
      "exitOnError": true
    }
  }
}
```

## Troubleshooting

### Common Issues

**Schema file not found:**
```bash
âŒ Error: Schema file not found: schema.js

Solution: Check the file path and ensure it exists
```

**Invalid schema definition:**
```bash
âŒ Error: Schema validation failed

Solution: Check schema syntax and required fields
```

**Environment variable missing:**
```bash
âŒ Error: Required environment variable "DATABASE_URL" is missing

Solution: Set the required environment variable
```

**Invalid value format:**
```bash
âŒ Error: PORT: Port must be an integer between 1 and 65535

Solution: Set a valid port number
```

### Debug Mode

Enable verbose output for detailed information:

```bash
env-guard validate --schema schema.js --verbose
```

### Validation Tips

1. **Use `--detailed` for more information:**
```bash
env-guard validate --schema schema.js --detailed
```

2. **Check schema first:**
```bash
env-guard check --schema schema.js --validate
```

3. **Generate examples for reference:**
```bash
env-guard generate --schema schema.js --include-comments
```

4. **Use JSON format for scripting:**
```bash
env-guard validate --schema schema.js --format json > results.json
```

### Getting Help

```bash
# Global help
env-guard --help

# Command-specific help
env-guard validate --help
env-guard generate --help
env-guard check --help
```

### Common Schema Patterns

**API Service:**
```javascript
{
  PORT: { type: 'port', required: true, default: 3000 },
  DATABASE_URL: { type: 'url', required: true },
  JWT_SECRET: { type: 'string', required: true, minLength: 32 },
  NODE_ENV: { type: 'string', enum: ['development', 'production'] }
}
```

**Frontend App:**
```javascript
{
  REACT_APP_API_URL: { type: 'url', required: true },
  REACT_APP_VERSION: { type: 'string', required: true },
  REACT_APP_DEBUG: { type: 'boolean', default: false }
}
```

**Database Service:**
```javascript
{
  DATABASE_URL: { type: 'url', required: true },
  DATABASE_POOL_SIZE: { type: 'number', min: 1, max: 100, default: 10 },
  DATABASE_TIMEOUT: { type: 'number', min: 1000, default: 30000 }
}