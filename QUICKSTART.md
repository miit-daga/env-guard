# ðŸš€ env-guard Quick Start Guide

Get up and running with env-guard in 5 minutes!

## What You'll Learn

- How to install env-guard
- How to create your first schema
- How to validate environment variables
- How to use the CLI tool
- Best practices for different environments

## Prerequisites

- Node.js 14+ installed
- Basic knowledge of environment variables
- Text editor of your choice

## Step 1: Installation

### For New Projects

```bash
# Create a new project directory
mkdir my-app
cd my-app

# Initialize npm
npm init -y

# Install @miit-daga/env-guard
npm install @miit-daga/env-guard

# Optional: Install TypeScript types
npm install --save-dev @types/node
```

### For Existing Projects

```bash
# Install in your existing project
npm install @miit-daga/env-guard
```

## Step 2: Create Your First Schema

Create a file called `schema.js` in your project root:

```javascript
// schema.js
const { defineSchema } = require('@miit-daga/env-guard');

// Define your environment variable requirements
const schema = defineSchema({
  // Required server configuration
  PORT: {
    type: 'port',
    required: true,
    default: 3000,
    description: 'Server port number'
  },
  
  // Environment mode
  NODE_ENV: {
    type: 'string',
    enum: ['development', 'production', 'test'],
    default: 'development'
  },
  
  // Database configuration
  DATABASE_URL: {
    type: 'url',
    required: true,
    description: 'PostgreSQL connection string'
  },
  
  // Optional API key with validation
  API_KEY: {
    type: 'string',
    required: false,
    minLength: 32,
    default: ''
  },
  
  // Debug flag
  DEBUG: {
    type: 'boolean',
    default: false
  }
});

module.exports = schema;
```

## Step 3: Validate Environment Variables

### In Your Application

Create `app.js`:

```javascript
// app.js
const { validateEnv } = require('@miit-daga/env-guard');
const schema = require('./schema');

// Validate your environment variables
const result = validateEnv(schema, process.env);

if (!result.success) {
  console.error('âŒ Environment validation failed:');
  result.errors.forEach(error => {
    console.log(`  ${error.field}: ${error.message}`);
  });
  process.exit(1);
}

console.log('âœ… Environment validation successful!');

// Use the validated data
const env = result.data;
console.log(`ðŸš€ Starting server on port ${env.PORT} in ${env.NODE_ENV} mode`);

// Your app code here...
```

### Run Your Application

```bash
# Set some environment variables
export PORT=3000
export NODE_ENV=development
export DATABASE_URL=postgresql://localhost:5432/mydb
export API_KEY=your-32-character-minimum-api-key

# Run your application
node app.js
```

**Expected Output:**
```
âœ… Environment validation successful!
ðŸš€ Starting server on port 3000 in development mode
```

## Step 4: Generate .env.example

Use the CLI to generate a template file:

```bash
# Install CLI globally (optional)
npm install -g @miit-daga/env-guard

# Generate .env.example file
env-guard generate --schema schema.js --include-comments
```

This creates a `.env.example` file:

```bash
# Generated by env-guard
# Server port number
PORT=3000
# Environment (development, production, test)
NODE_ENV=development
# PostgreSQL connection string
DATABASE_URL=postgresql://localhost:5432/yourdb
# API authentication key
API_KEY=your-32-character-minimum-api-key
# Debug mode
DEBUG=false
```

## Step 5: Use in Different Environments

### Development (.env.development)

```bash
PORT=3000
NODE_ENV=development
DATABASE_URL=postgresql://localhost:5432/devdb
DEBUG=true
```

### Production (.env.production)

```bash
PORT=8080
NODE_ENV=production
DATABASE_URL=postgresql://prod-db:5432/proddb
API_KEY=real-production-api-key
DEBUG=false
```

### Loading Different Environments

```javascript
// Load environment-specific file
require('dotenv').config({ path: `.env.${process.env.NODE_ENV}` });

const result = validateEnv(schema, process.env);
```

## Step 6: Advanced Features

### Custom Validators

```javascript
const schema = defineSchema({
  EMAIL: {
    type: 'string',
    required: true,
    validate: (value) => {
      if (!value.includes('@company.com')) {
        return 'Must be a company email address';
      }
      return true;
    }
  }
});
```

### Environment-Specific Rules

```javascript
const schema = defineSchema({
  ADMIN_EMAIL: {
    type: 'string',
    required: false,
    description: 'Administrator email for notifications'
  },
  _environments: {
    production: {
      ADMIN_EMAIL: {
        required: true  // Required in production
      }
    }
  }
});
```

### Transforms

```javascript
const schema = defineSchema({
  DATABASE_URL: {
    type: 'string',
    transform: (url) => {
      // Replace localhost with IP in production
      return url.replace('localhost', '127.0.0.1');
    }
  }
});
```

## Step 7: CLI Usage Examples

### Validate Current Environment

```bash
# Validate against schema
env-guard validate --schema schema.js

# Production environment
env-guard validate --schema schema.js --environment production

# JSON output for automation
env-guard validate --schema schema.js --format json
```

### Check Schema Definition

```bash
# Validate your schema
env-guard check --schema schema.js --detailed
```

## Common Use Cases

### Express.js Application

```javascript
// app.js
const express = require('express');
const { defineSchema, validateEnv } = require('@miit-daga/env-guard');

const app = express();

// Define schema
const schema = defineSchema({
  PORT: { type: 'port', required: true, default: 3000 },
  DATABASE_URL: { type: 'url', required: true },
  JWT_SECRET: { type: 'string', required: true, minLength: 32 }
});

// Validate environment
const envResult = validateEnv(schema, process.env);
if (!envResult.success) {
  console.error('âŒ Environment validation failed:', envResult.errors);
  process.exit(1);
}

const env = envResult.data;

// Configure app
app.set('port', env.PORT);

// Use env values in your app
app.get('/', (req, res) => {
  res.json({
    message: 'Hello from env-guard!',
    port: env.PORT,
    nodeEnv: process.env.NODE_ENV
  });
});

app.listen(env.PORT, () => {
  console.log(`ðŸš€ Server running on port ${env.PORT}`);
});
```

### Next.js Configuration

```javascript
// next.config.js
const { defineSchema, validateEnv } = require('@miit-daga/env-guard');

const schema = defineSchema({
  DATABASE_URL: { type: 'url', required: true },
  NEXT_PUBLIC_API_URL: { type: 'url', required: true },
  API_SECRET: { type: 'string', required: true, minLength: 32 }
});

const envValidation = validateEnv(schema, process.env);
if (!envValidation.success) {
  console.error('âŒ Environment validation failed');
  process.exit(1);
}

module.exports = {
  env: {
    NEXT_PUBLIC_API_URL: envValidation.data.NEXT_PUBLIC_API_URL
  }
};
```

## Next Steps

### 1. Explore Examples
Check out the `examples/` directory for:
- Basic usage examples
- Framework integrations (Express, Next.js, NestJS)
- Real-world application patterns

### 2. Read Documentation
- [API Reference](API.md) - Complete function documentation
- [CLI Guide](CLI.md) - Command-line interface details
- [README.md](README.md) - Project overview and features

### 3. Integration Guides
- **Express.js**: See `examples/express-integration.js`
- **Next.js**: See `examples/nextjs-integration.js`
- **NestJS**: See `examples/nestjs-integration.js`
- **Microservices**: See `examples/microservice-api.js`
- **Full-Stack**: See `examples/fullstack-app.js`

## Best Practices

### 1. Schema Organization
```javascript
// config/schema.js
const { defineSchema } = require('@miit-daga/env-guard');

module.exports = defineSchema({
  // Group related fields
  server: {
    PORT: { type: 'port', required: true, default: 3000 },
    HOST: { type: 'string', default: 'localhost' }
  },
  
  database: {
    DATABASE_URL: { type: 'url', required: true },
    DATABASE_POOL_SIZE: { type: 'number', min: 1, max: 100, default: 10 }
  },
  
  // Environment-specific rules
  _environments: {
    production: {
      server: { HOST: { default: '0.0.0.0' } }
    }
  }
});
```

### 2. Error Handling
```javascript
const result = validateEnv(schema, process.env);

if (!result.success) {
  // Log errors for debugging
  console.error('Environment validation failed:', result.errors);
  
  // Exit gracefully in production
  if (process.env.NODE_ENV === 'production') {
    process.exit(1);
  }
  
  // In development, show helpful message
  console.log('Please check your .env file or environment variables');
}
```

### 3. Environment Variables
```bash
# .env (don't commit this!)
DATABASE_URL=postgresql://localhost:5432/mydb
API_KEY=your-32-character-api-key

# .env.example (commit this!)
DATABASE_URL=postgresql://localhost:5432/yourdb
API_KEY=your-32-character-minimum-api-key
```

## Troubleshooting

### Common Issues

**"Required environment variable is missing"**
```bash
# Solution: Set the required variable
export DATABASE_URL=postgresql://localhost:5432/yourdb
```

**"Cannot coerce to number"**
```bash
# Solution: Set a valid number
export PORT=3000  # not "3000a"
```

**"Invalid email format"**
```bash
# Solution: Use valid email format
export ADMIN_EMAIL=user@company.com
```

### Debug Mode
```javascript
// Enable detailed error information
const result = validateEnv(schema, process.env);
if (result.hasErrors) {
  result.errors.forEach(error => {
    console.log(`Field: ${error.field}`);
    console.log(`Message: ${error.message}`);
    console.log(`Expected: ${error.expected}`);
    console.log(`Received: ${error.received}`);
    console.log('---');
  });
}
```

## Getting Help

- **Check the examples**: `examples/` directory
- **Read the docs**: [API.md](API.md), [CLI.md](CLI.md)
- **Run the tests**: `npm test`
- **Validate schemas**: `env-guard check --schema your-schema.js`

## Summary

ðŸŽ‰ **Congratulations!** You now know how to:

1. âœ… Install and set up env-guard
2. âœ… Create schemas for environment variables
3. âœ… Validate environment variables in your code
4. âœ… Use the CLI tool for validation and generation
5. âœ… Handle different environments
6. âœ… Use advanced features like custom validators and transforms

**You're ready to build robust, production-ready applications with proper environment management!**

For more advanced usage, explore the [examples](examples/) directory and read the full [API documentation](API.md).